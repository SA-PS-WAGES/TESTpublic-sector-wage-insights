<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EB25: It's still about pay - Home</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1220;
      --line:rgba(255,255,255,.10);
      --text:#F5F7FF;
      --muted:rgba(245,247,255,.72);
      --accent:#6EE7FF;
      --accent2:#A78BFA;
      --radius:18px;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --max: 1100px;
      --good:#4ADE80;
      --warn:#FBBF24;
      --bad:#F87171;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 12% 10%, rgba(110,231,255,.20), transparent 60%),
        radial-gradient(700px 500px at 88% 0%, rgba(167,139,250,.22), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      line-height:1.45;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }
    .wrap{ max-width:var(--max); margin:0 auto; padding: 32px 16px 28px; }

    /* Header */
    .topbar{
      position: relative;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      padding: 10px 12px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      margin-bottom: 22px;
    }
    #gc-hud{
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 900;
      letter-spacing: .18em;
      color: rgba(245,247,255,.95);
      opacity: .7;
      background: transparent;
      border: 0;
      box-shadow: none;
      pointer-events: none;
      white-space: nowrap;
      user-select: none;
      z-index: 2;
    }
    .brand{ display:flex; align-items:center; gap:10px; min-width: 0; }
    .mark{
      width:34px; height:34px;
      border-radius: 12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(110,231,255,.95), transparent 70%),
        radial-gradient(18px 18px at 70% 70%, rgba(167,139,250,.95), transparent 70%);
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      flex: 0 0 auto;
    }
    .brandname{
      font-weight:850;
      letter-spacing:.2px;
      padding-left: 6px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color: rgba(245,247,255,.92);
      line-height: 1.15;
      font-size: 18px;
    }
    .nav{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:flex-end; align-items:center;
      margin-left: auto;
    }
    .iconPill{
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--accent);
      flex:0 0 auto;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .iconPill svg{ width:16px; height:16px; fill: currentColor; }
    .iconPill:hover{ background: rgba(255,255,255,.06); text-decoration:none; }
    .homePill{ text-decoration:none; }
    .menuIconWrap{ position: relative; }
    details.menu{ position: relative; z-index: 2; }
    details.menu summary{ list-style:none; }
    details.menu summary::-webkit-details-marker{ display:none; }
    .menuList{
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      min-width: 240px;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(110,231,255,.25);
      background: rgba(7,10,18,.98);
      box-shadow: 0 20px 44px rgba(0,0,0,.5);
      display:flex;
      flex-direction: column;
      gap: 6px;
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
      transition: all .2s ease;
    }
    .menu[open] .menuList{
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    .menuLink{
      display:flex; align-items:center; justify-content:space-between;
      padding: 8px 10px;
      border-radius: 12px;
      color: rgba(245,247,255,.92);
      font-weight: 850;
      font-size: 13px;
      background: rgba(255,255,255,.04);
      border: 1px solid transparent;
    }
    .menuLink:hover{
      border-color: rgba(110,231,255,.45);
      background: rgba(110,231,255,.12);
      text-decoration:none;
    }
    .menuLink.isActive{
      border-color: rgba(110,231,255,.6);
      background: linear-gradient(135deg, rgba(110,231,255,.18), rgba(167,139,250,.18));
      color: rgba(245,247,255,.98);
    }
    @media (max-width: 720px){
      .topbar{ border-radius: 22px; padding: 12px; gap: 12px; }
      .brand{ align-items: flex-start; }
      .brandname{ font-size: 13px; }
      .iconPill{ width:32px; height:32px; }
      .iconPill svg{ width:14px; height:14px; }
      .menuList{ right: 0; min-width: 240px; width: 240px; max-width: 90vw; }
    }

    /* Hero */
    .hero{
      margin-top: 0;
      padding: 28px 18px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background:
        radial-gradient(900px 240px at 20% 0%, rgba(110,231,255,.16), transparent 55%),
        radial-gradient(900px 240px at 80% 0%, rgba(167,139,250,.16), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .heroTitle{
      margin:0 0 12px 0;
      font-size: clamp(36px, 5vw, 64px);
      line-height: 1.02;
      letter-spacing: -1px;
    }
    .heroTitle .grad{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }
    .heroSub{
      max-width: 100%;
      margin: 12px 0 0 0;
      font-size: clamp(16px, 1.35vw, 20px);
      line-height: 1.35;
      font-weight: 750;
      letter-spacing: -0.15px;
      color: rgba(245,247,255,.88);
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(520px 180px at 20% 0%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(520px 180px at 80% 0%, rgba(167,139,250,.12), transparent 60%),
        rgba(255,255,255,.03);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .heroSub strong{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      font-weight: 900;
    }

    /* Section */
    .section{
      margin-top: 18px;
      padding: 18px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .sectionHead{
      display:flex; justify-content:space-between; align-items:flex-end;
      flex-wrap:wrap; gap:12px; margin-bottom: 10px;
    }
    .sectionHead h2{ margin:0; font-size: 18px; letter-spacing: -.2px; }
    .small{ font-size: 12px; color: var(--muted); }

    /* Calculator cards */
    .grid{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    .card{
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding: 16px;
    }
    .card h3{ margin:0 0 10px 0; font-size: 16px; letter-spacing: -.2px; }
    label{ display:block; margin-top: 10px; font-size: 13px; color: rgba(245,247,255,.86); }
    input[type="number"], input[type="text"], input[type="search"]{
      width: 100%;
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }
    input:focus{
      border-color: rgba(110,231,255,.45);
      box-shadow: 0 0 0 4px rgba(110,231,255,.12);
    }

    .pillRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top: 10px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      color: rgba(245,247,255,.9);
      font-size: 12px;
      font-weight: 850;
      letter-spacing:.1px;
      cursor:pointer;
      user-select:none;
    }
    .chip input{ margin:0; }
    .chip.isActive{
      border-color: rgba(110,231,255,.5);
      background: rgba(110,231,255,.10);
    }

    .checkRow{
      display:flex; align-items:flex-start; gap:10px;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }
    .checkRow input{ margin-top: 2px; }
    .checkRow .hint{ font-size: 12px; color: var(--muted); margin-top: 3px; }

    .btnRow{ display:flex; flex-wrap:wrap; gap: 10px; margin-top: 14px; }
    .btn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(420px 160px at 20% 0%, rgba(110,231,255,.14), transparent 60%),
        radial-gradient(420px 160px at 80% 0%, rgba(167,139,250,.14), transparent 60%),
        rgba(255,255,255,.03);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 850;
    }
    .btn:hover{ background: rgba(255,255,255,.06); }

    /* Searchable dropdown */
    .comboWrap{ position: relative; }
    .comboList{
      position:absolute;
      top: calc(100% + 8px);
      left:0; right:0;
      max-height: 320px;
      overflow:auto;
      border-radius: 14px;
      border: 1px solid rgba(110,231,255,.35);
      background: rgba(7,10,18,.98);
      box-shadow: 0 18px 44px rgba(0,0,0,.45);
      z-index: 10;
      display:none;
    }
    .comboItem{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      cursor:pointer;
    }
    .comboItem:last-child{ border-bottom:0; }
    .comboItem:hover, .comboItem.isActive{ background: rgba(110,231,255,.10); }
    .comboTop{
      display:flex; justify-content:space-between; gap:10px; align-items:baseline;
      font-weight: 900;
    }
    .comboSub{
      margin-top: 2px;
      font-size: 12px;
      color: rgba(245,247,255,.72);
    }
    .badge{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.12em;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(245,247,255,.86);
      white-space: nowrap;
    }

    /* Conditions */
    .condGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px){
      .condGrid{ grid-template-columns: 1fr; }
    }
    .condList{
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      max-height: 420px;
      overflow:auto;
    }
    .condItem{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .condItem:last-child{ border-bottom:0; }
    .condItem .condMeta{ flex: 1; min-width: 0; }
    .condItem .condTitle{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      font-weight: 900;
    }
    .condRef{
      font-size: 11px;
      font-weight: 950;
      letter-spacing:.12em;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(110,231,255,.35);
      background: rgba(110,231,255,.10);
      color: rgba(245,247,255,.95);
      white-space: nowrap;
    }
    .condDesc{
      margin-top: 2px;
      font-size: 12px;
      color: rgba(245,247,255,.72);
    }
    .condInputs{ margin-top: 8px; display:flex; gap:10px; flex-wrap:wrap; }
    .condInputs input[type="number"]{
      width: 220px;
      max-width: 100%;
      margin-top: 0;
    }
    .miniHelp{
      margin-top: 6px;
      font-size: 12px;
      color: rgba(245,247,255,.72);
    }

    /* Outputs */
    .kpiGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 980px){ .kpiGrid{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 520px){ .kpiGrid{ grid-template-columns: 1fr;} }

    .kpi{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(520px 180px at 20% 0%, rgba(110,231,255,.10), transparent 60%),
        radial-gradient(520px 180px at 80% 0%, rgba(167,139,250,.10), transparent 60%),
        rgba(0,0,0,.12);
      padding: 12px 12px;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }
    .kpi .k{ font-size: 12px; color: var(--muted); font-weight: 900; letter-spacing:.12em; text-transform: uppercase; }
    .kpi .v{ margin-top: 6px; font-size: 18px; font-weight: 950; letter-spacing:-.2px; }
    .kpi .s{ margin-top: 4px; font-size: 12px; color: rgba(245,247,255,.78); }

    .tableWrap{
      margin-top: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      overflow:auto;
      background: rgba(0,0,0,.18);
    }
    table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 1040px;
      font-size: 14px;
    }
    thead th{
      position: sticky;
      top: 0;
      z-index: 1;
      text-align: left;
      padding: 10px 12px;
      background: rgba(11,18,32,.92);
      color: rgba(245,247,255,.92);
      border-bottom: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      white-space: nowrap;
    }
    tbody td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      color: rgba(245,247,255,.86);
      white-space: nowrap;
    }
    tbody tr:nth-child(odd){ background: rgba(255,255,255,.02); }
    tbody tr:hover{ background: rgba(110,231,255,.06); }
    .rowLabel{ font-weight: 900; }
    .num{ text-align: right; font-variant-numeric: tabular-nums; }
    .numStrong{ color: var(--accent); font-weight: 900; }
    .pos{ color: var(--good); font-weight: 900; }
    .neg{ color: var(--bad); font-weight: 900; }

    .infoBox{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(520px 180px at 20% 0%, rgba(110,231,255,.10), transparent 60%),
        radial-gradient(520px 180px at 80% 0%, rgba(167,139,250,.10), transparent 60%),
        rgba(255,255,255,.02);
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      padding: 14px 16px;
      margin-top: 12px;
    }
    .infoBox h3{ margin:0 0 8px 0; font-size: 14px; font-weight: 900; letter-spacing: -.2px; }
    .infoBox p{ margin:0; color: var(--muted); font-size: 13px; }

    .footer{
      margin-top: 20px;
      padding: 16px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      text-align: center;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }
    .backToTop{
      display: inline-flex; align-items: center; justify-content: center;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid rgba(110,231,255,.4);
      background: rgba(110,231,255,.12);
      color: var(--accent);
      font-weight: 900;
      letter-spacing: .2px;
      text-decoration: none;
    }
    .backToTop:hover{ background: rgba(110,231,255,.2); text-decoration: none; }

    /* Bubble */
    .recoveryBubble{
      margin-bottom: 14px;
      padding: 16px 18px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(520px 200px at 20% 0%, rgba(110,231,255,.14), transparent 60%),
        radial-gradient(520px 200px at 80% 0%, rgba(167,139,250,.14), transparent 60%),
        rgba(0,0,0,.18);
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    .rbTitle{ margin: 0; font-size: clamp(18px, 2vw, 22px); font-weight: 950; letter-spacing: -.4px; line-height: 1.15; }
    .rbTitle .grad{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .rbGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: stretch;
      margin-top: 12px;
    }
    @media (max-width: 820px){ .rbGrid{ grid-template-columns: 1fr; } }
    .rbBlock{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
    }
    .rbKicker{
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .14em;
      margin: 0 0 8px 0;
    }
    .rbBig{
      margin: 0;
      font-size: clamp(18px, 2.2vw, 24px);
      line-height: 1.15;
      font-weight: 950;
      letter-spacing: -0.3px;
      color: rgba(245,247,255,.95);
    }
    .rbBig strong{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 950;
    }
    .rbSub{
      margin: 8px 0 0 0;
      font-size: 14.5px;
      line-height: 1.35;
      color: rgba(245,247,255,.86);
    }
    .rbLink{
      color: rgba(245,247,255,.95);
      text-decoration: none;
      border-bottom: 2px solid rgba(110,231,255,.40);
      padding-bottom: 1px;
    }
    .rbLink:hover{
      color: var(--accent);
      border-bottom-color: rgba(110,231,255,.85);
      text-decoration: none;
    }
    .rbCTA{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(420px 160px at 20% 0%, rgba(110,231,255,.10), transparent 60%),
        radial-gradient(420px 160px at 80% 0%, rgba(167,139,250,.10), transparent 60%),
        rgba(0,0,0,.12);
    }
    .rbPill{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(245,247,255,.90);
      font-size: 12px;
      font-weight: 950;
      letter-spacing: .14em;
      margin-bottom: 10px;
    }
  </style>

  <!-- keep your site-wide stylesheet if you have one -->
  <link rel="stylesheet" href="assets/css/theme.css">
</head>

<body id="top">
  <div class="wrap">
    <div class="topbar">
      <div id="gc-hud" aria-hidden="true">Views: —</div>
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div class="brandname">EB25 It's <i>still</i> about pay</div>
      </div>

      <div class="nav">
        <a class="iconPill homePill" href="index.html" aria-label="Home">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3.2 3 10.4v9.1c0 .7.6 1.3 1.3 1.3h5.4v-6.1h4.6v6.1h5.4c.7 0 1.3-.6 1.3-1.3v-9.1L12 3.2z"/>
          </svg>
        </a>

        <div class="menuIconWrap" aria-label="Menu">
          <details class="menu">
            <summary class="iconPill" aria-label="Open menu">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 6.5h16c.6 0 1-.4 1-1s-.4-1-1-1H4c-.6 0-1 .4-1 1s.4 1 1 1zm16 5.5H4c-.6 0-1 .4-1 1s.4 1 1 1h16c.6 0 1-.4 1-1s-.4-1-1-1zm0 7H4c-.6 0-1 .4-1 1s.4 1 1 1h16c.6 0 1-.4 1-1s-.4-1-1-1z"/>
              </svg>
            </summary>

            <div class="menuList">
              <a class="menuLink isActive" href="index.html">Home</a>
              <a class="menuLink" href="voting-power.html">Voting Power</a>
              <a class="menuLink" href="Union Reform.html">The Member's Union</a>
              <a class="menuLink" href="methodology.html">Sources &amp; Method</a>
            </div>
          </details>
        </div>
      </div>
    </div>

    <section class="hero">
      <h1 class="heroTitle">
        <span class="grad"><strong>EB25:</strong> It's <i>still</i> about pay</span>
      </h1>

      <p class="heroSub">
        Salaried Public Sector workers have faced poor wage outcomes falling behind inflation since 2021.<br>
        <strong>Our wages have never recovered.</strong><br><br>
        The current offer as it stands fails to address this.<br>
        We need 10.5% <strong>now</strong> <i>or</i> 14% by mid-2026<br>
        Those below the award need an <strong>additional 2-3%</strong><br><br>
        We <strong>ALL</strong> deserve fair pay <strong>NOW.</strong>
      </p>
    </section>

    <section class="section" id="calculator" style="margin-top:18px;">
      <div class="recoveryBubble" role="note" aria-label="Wage erosion message">
        <div class="rbTop">
          <h3 class="rbTitle">
            <span class="grad">Use your classification to estimate your take-home pay under the proposed salary schedule.</span>
          </h3>
        </div>

        <div class="rbGrid">
          <div class="rbBlock">
            <div class="rbKicker">Before you vote</div>
            <p class="rbBig">
              Check your cohort’s
              <a href="voting-power.html" class="rbLink"><strong>VOTING POWER</strong></a>
            </p>
            <p class="rbSub">
              Bigger cohorts can swing outcomes - know where yours sits.
            </p>
          </div>

          <div class="rbCTA">
            <div class="rbPill">CALCULATOR</div>
            <p class="rbBig" style="margin:0;">
              See your <strong>TAKE-HOME PAY</strong><br/>
              by classification + conditions
            </p>
            <p class="rbSub" style="margin:8px 0 0 0;">
              Search your classification (e.g. <strong>ASO4.1</strong>) and tick any applicable conditions.
            </p>
          </div>
        </div>
      </div>

      <div class="sectionHead" style="margin-bottom:8px;">
        <h2>Net Pay Calculator</h2>
        <div class="small">Estimates only. Use for comparison, not tax advice.</div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Inputs</h3>

          <label for="classSearch">Classification (type to search)</label>
          <div class="comboWrap">
            <input type="search" id="classSearch" placeholder="e.g. ASO4.1, OPS2.3, CO3.1…" autocomplete="off" />
            <div id="classList" class="comboList" role="listbox" aria-label="Classification results"></div>
          </div>
          <div class="miniHelp" id="classSelectedHelp">No classification selected yet.</div>

          <label for="fte">FTE (1.0 = full-time)</label>
          <input type="number" id="fte" step="0.01" min="0.1" max="1.0" value="1.0" />

          <div class="pillRow" id="dateChips" aria-label="Effective dates">
            <label class="chip isActive"><input type="radio" name="effDate" value="salary_current" checked> Current</label>
            <label class="chip"><input type="radio" name="effDate" value="salary_2025_08_01"> 1 Aug 2025</label>
            <label class="chip"><input type="radio" name="effDate" value="salary_2026_07_01"> 1 Jul 2026</label>
            <label class="chip"><input type="radio" name="effDate" value="salary_2027_07_01"> 1 Jul 2027</label>
          </div>

          <div id="unitOverrideWrap" style="display:none;">
            <label for="annualisedOverride">Annualised gross (only if your classification is not an annual salary)</label>
            <input type="number" id="annualisedOverride" inputmode="numeric" placeholder="e.g. 85000" />
            <div class="miniHelp">Your selected classification is listed as a unit/hourly rate in the schedule. Enter your annualised gross to use the calculator.</div>
          </div>

          <div class="checkRow">
            <input type="checkbox" id="hasHELP" />
            <div>
              <label for="hasHELP" style="margin:0;">I have a HELP or HECS loan</label>
              <div class="hint">Simplified estimate for comparison.</div>
            </div>
          </div>

          <div class="checkRow">
            <input type="checkbox" id="noPrivateHealth" />
            <div>
              <label for="noPrivateHealth" style="margin:0;">I do NOT have private hospital insurance (MLS may apply)</label>
              <div class="hint">Simplified MLS thresholds (single).</div>
            </div>
          </div>

          <div class="checkRow" id="awardToggleWrap" style="display:none;">
            <input type="checkbox" id="applyAwardMin" />
            <div>
              <label for="applyAwardMin" style="margin:0;">Apply award minimum (if higher)</label>
              <div class="hint">Uses an award-rate lookup file if present (optional).</div>
            </div>
          </div>

          <label for="otherAnnual">Other annual allowances ($)</label>
          <input type="number" id="otherAnnual" inputmode="numeric" value="0" />

          <label for="otherFortnight">Other fortnightly allowances ($)</label>
          <input type="number" id="otherFortnight" inputmode="numeric" value="0" />

          <div class="btnRow">
            <button class="btn" id="btnCalc" type="button">Calculate</button>
            <button class="btn" id="btnClear" type="button">Clear</button>
          </div>
        </div>

        <div class="card">
          <h3>Conditions &amp; allowances</h3>
          <div class="small">Search and tick anything that applies. Clause numbers match the agreement for easy reference.</div>

          <label for="condSearch">Search conditions (e.g. “on-call”, “17.1”, “CIO”)</label>
          <input type="search" id="condSearch" placeholder="Type to filter the list…" autocomplete="off" />

          <div class="condGrid">
            <div>
              <div class="small" style="margin-top:10px;">Calculable items (changes pay)</div>
              <div id="condCalc" class="condList" aria-label="Calculable conditions"></div>
            </div>

            <div>
              <div class="small" style="margin-top:10px;">Information items (eligibility notes)</div>
              <div id="condInfo" class="condList" aria-label="Informational conditions"></div>
            </div>
          </div>

          <div class="infoBox" style="margin-top:12px;">
            <h3>What this does (and doesn’t) do</h3>
            <p>
              This tool estimates base salary + selected allowances/penalties, then estimates tax, Medicare, MLS and HELP.
              It does <strong>not</strong> model overtime, shift patterns, leave loading, super, or agency-specific arrangements unless you add them as “Other allowances”.
            </p>
          </div>
        </div>
      </div>

      <div id="outputs" style="display:none;">
        <div class="kpiGrid" id="kpiGrid"></div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Scenario</th>
                <th class="num">Base gross</th>
                <th class="num">Extras</th>
                <th class="num">Total gross</th>
                <th class="num">Change vs current</th>
                <th class="num">Annual net</th>
                <th class="num">Fortnight net</th>
              </tr>
            </thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>

        <div class="infoBox">
          <h3>Notes</h3>
          <p id="notesText">—</p>
        </div>
      </div>
    </section>

    <section class="section" id="disclaimer">
      <div class="infoBox" style="margin-top:0;">
        <h3>Disclaimer</h3>
        <p>
          This site is a public data explainer only and does not provide industrial relations advice, voting guidance, financial advice, or tax advice.
          Figures are presented for transparency and comparison using published schedules and simplified assumptions.
        </p>
      </div>
    </section>

    <footer class="footer">
      <a class="backToTop" href="#top">Back to top</a>
    </footer>
  </div>

  <script>
    // ==========================================================
    //  Tax helpers (same approach as your original calculator)
    // ==========================================================
    function calcIncomeTax(income){
      let tax = 0;
      if (income > 190000){ tax += (income - 190000) * 0.45; income = 190000; }
      if (income > 135000){ tax += (income - 135000) * 0.37; income = 135000; }
      if (income > 45000){  tax += (income - 45000)  * 0.30; income = 45000; }
      if (income > 18200){  tax += (income - 18200)  * 0.16; }
      return tax;
    }
    function calcMedicareLevy(income){ return income * 0.02; }
    function calcMLS(income, noPrivate){
      if (!noPrivate) return 0;
      if (income <= 101000) return 0;
      if (income <= 118000) return income * 0.01;
      if (income <= 158000) return income * 0.0125;
      return income * 0.015;
    }
    function calcHELP(income){
      const thresholds = [
        { limit: 54435, rate: 0 },
        { limit: 62850, rate: 0.01 },
        { limit: 66620, rate: 0.02 },
        { limit: 70618, rate: 0.025 },
        { limit: 74855, rate: 0.03 },
        { limit: 79346, rate: 0.035 },
        { limit: 84107, rate: 0.04 },
        { limit: 89154, rate: 0.045 },
        { limit: 94503, rate: 0.05 },
        { limit: 100174, rate: 0.055 },
        { limit: 106185, rate: 0.06 },
        { limit: 112556, rate: 0.065 },
        { limit: 119309, rate: 0.07 },
        { limit: 126467, rate: 0.075 },
        { limit: 134056, rate: 0.08 },
        { limit: 142100, rate: 0.085 },
        { limit: 150626, rate: 0.09 },
        { limit: 159663, rate: 0.095 },
        { limit: Infinity, rate: 0.10 }
      ];
      for (const b of thresholds){
        if (income <= b.limit) return income * b.rate;
      }
      return 0;
    }
    function netPay(income, hasHELP, noPrivate){
      const tax  = calcIncomeTax(income);
      const med  = calcMedicareLevy(income);
      const mls  = calcMLS(income, noPrivate);
      const help = hasHELP ? calcHELP(income) : 0;
      return {
        net: income - tax - med - mls - help,
        breakdown: { tax, med, mls, help }
      };
    }
    function fmtMoney(n, decimals=0){
      if (n === null || n === undefined || isNaN(n)) return "—";
      return "$" + Number(n).toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function fmtPct(n, decimals=2){
      if (n === null || n === undefined || isNaN(n)) return "—";
      return (Number(n)*100).toFixed(decimals) + "%";
    }

    // ==========================================================
    //  Load data (place JSONs in your repo under /assets/data/)
    //    Required:
    //      /assets/data/sa_salaried_rates.json
    //    Optional:
    //      /assets/data/award_minimums.json
    // ==========================================================
    let DATA = null;
    let AWARD_MIN = null;

    async function loadJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("HTTP " + r.status);
      return await r.json();
    }

    async function init(){
      try{
        DATA = await loadJson("assets/data/sa_salaried_rates.json");
      }catch(e){
        console.error(e);
        document.getElementById("classSelectedHelp").textContent =
          "ERROR: Missing assets/data/sa_salaried_rates.json";
        return;
      }

      // optional award minima
      try{
        AWARD_MIN = await loadJson("assets/data/award_minimums.json");
        document.getElementById("awardToggleWrap").style.display = "flex";
      }catch(e){
        AWARD_MIN = null;
        document.getElementById("awardToggleWrap").style.display = "none";
      }

      buildClassificationIndex();
      buildConditionsLists();
      wireUI();
    }

    // ==========================================================
    //  Classification search (type-to-filter list)
    // ==========================================================
    let ROLE_INDEX = [];
    let SELECTED_ROLE = null;
    let ACTIVE_CLASS_IDX = -1;

    function roleDisplayName(r){
      const parts = [];
      if (r.code) parts.push(r.code);
      if (r.classification_label) parts.push("— " + r.classification_label);
      if (r.increment_label) parts.push("(" + r.increment_label + ")");
      return parts.join(" ");
    }

    function buildClassificationIndex(){
      const roles = DATA.roles || [];
      ROLE_INDEX = roles.map(r => {
        const code = (r.code || "").toUpperCase();
        const label = (r.classification_label || "").toUpperCase();
        const stream = (r.stream || "").toUpperCase();
        const schedule = (r.schedule_title || "").toUpperCase();
        const key = (code + " " + label + " " + stream + " " + schedule).trim();
        return { r, key };
      });
    }

    function filterRoles(q){
      const s = (q || "").trim().toUpperCase();
      if (!s) return ROLE_INDEX.slice(0, 30);
      const out = ROLE_INDEX.filter(x => x.key.includes(s));
      // exact prefix boost
      out.sort((a,b) => {
        const ap = a.r.code?.toUpperCase()?.startsWith(s) ? 0 : 1;
        const bp = b.r.code?.toUpperCase()?.startsWith(s) ? 0 : 1;
        if (ap !== bp) return ap - bp;
        return (a.r.code || "").localeCompare(b.r.code || "");
      });
      return out.slice(0, 50);
    }

    function renderClassList(items){
      const box = document.getElementById("classList");
      box.innerHTML = "";
      if (!items.length){
        box.style.display = "none";
        return;
      }
      items.forEach((x, idx) => {
        const r = x.r;
        const div = document.createElement("div");
        div.className = "comboItem" + (idx === ACTIVE_CLASS_IDX ? " isActive" : "");
        div.setAttribute("role","option");
        div.dataset.idx = String(idx);
        div.innerHTML = `
          <div class="comboTop">
            <span>${r.code || "—"}</span>
            <span class="badge">${r.stream || "—"}</span>
          </div>
          <div class="comboSub">${(r.classification_label || "—")}${r.increment_label ? " · " + r.increment_label : ""}</div>
        `;
        div.addEventListener("click", () => selectRole(r));
        box.appendChild(div);
      });
      box.style.display = "block";
    }

    function selectRole(role){
      SELECTED_ROLE = role;
      const input = document.getElementById("classSearch");
      input.value = role.code || "";
      document.getElementById("classList").style.display = "none";

      const help = document.getElementById("classSelectedHelp");
      const base = role.salary_current;
      const rt = (role.rate_type || "").toLowerCase();
      help.textContent = `${roleDisplayName(role)} · ${role.stream || ""} · ${role.rate_type || ""}${base ? " · current " + fmtMoney(base,0) : ""}`;

      // show override if not annual salary
      const needsOverride = !(rt.includes("annual"));
      document.getElementById("unitOverrideWrap").style.display = needsOverride ? "block" : "none";
      document.getElementById("annualisedOverride").value = "";

      // rebuild conditions availability based on role flags
      applyRoleEligibilityToConditions();
    }

    function closeClassListIfClickedOutside(e){
      const wrap = document.querySelector(".comboWrap");
      if (wrap && !wrap.contains(e.target)){
        document.getElementById("classList").style.display = "none";
      }
    }

    // ==========================================================
    //  Conditions list
    // ==========================================================
    let COND_STATE = {};     // id -> { checked, inputs... }
    let COND_ELEMS = {};     // id -> element for filtering

    function buildConditionsLists(){
      const all = DATA.conditions_catalog || [];
      const calcBox = document.getElementById("condCalc");
      const infoBox = document.getElementById("condInfo");
      calcBox.innerHTML = "";
      infoBox.innerHTML = "";
      COND_STATE = {};
      COND_ELEMS = {};

      const calcItems = all.filter(x => x.kind !== "info");
      const infoItems = all.filter(x => x.kind === "info");

      calcItems.forEach(item => {
        const el = document.createElement("div");
        el.className = "condItem";
        el.dataset.ref = item.ref || "";
        el.dataset.label = (item.label || "").toLowerCase();

        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.id = "c_" + item.id;

        COND_STATE[item.id] = { checked:false };

        chk.addEventListener("change", () => {
          COND_STATE[item.id].checked = chk.checked;
        });

        const meta = document.createElement("div");
        meta.className = "condMeta";

        const title = document.createElement("div");
        title.className = "condTitle";
        title.innerHTML = `<span class="condRef">${item.ref || "—"}</span><span>${item.label || "—"}</span>`;
        meta.appendChild(title);

        const desc = document.createElement("div");
        desc.className = "condDesc";
        desc.textContent = item.kind === "fixed_allowance"
          ? ("Allowance (" + (item.unit || "—") + ")")
          : (item.kind === "percent_share_of_base" ? "Adds a percentage of base salary (share-based)." :
             item.kind === "per_occurrence" ? "Adds an amount per occurrence (you enter counts)." :
             "Adds to gross pay.");
        meta.appendChild(desc);

        // Inputs (if needed)
        const inputsWrap = document.createElement("div");
        inputsWrap.className = "condInputs";

        if (item.kind === "percent_share_of_base" && item.input){
          const inp = document.createElement("input");
          inp.type = "number";
          inp.min = item.input.min ?? 0;
          inp.max = item.input.max ?? 100;
          inp.step = 1;
          inp.value = item.input.default ?? 0;
          inp.placeholder = item.input.label || "Percent";
          inp.addEventListener("input", () => {
            COND_STATE[item.id][item.input.id] = Number(inp.value || 0);
          });
          COND_STATE[item.id][item.input.id] = Number(inp.value || 0);
          inputsWrap.appendChild(inp);
        }
        if (item.kind === "per_occurrence" && Array.isArray(item.inputs)){
          item.inputs.forEach(sub => {
            const inp = document.createElement("input");
            inp.type = "number";
            inp.min = sub.min ?? 0;
            inp.max = sub.max ?? 100;
            inp.step = 1;
            inp.value = sub.default ?? 0;
            inp.placeholder = sub.label || "Count";
            inp.addEventListener("input", () => {
              COND_STATE[item.id][sub.id] = Number(inp.value || 0);
            });
            COND_STATE[item.id][sub.id] = Number(inp.value || 0);
            inputsWrap.appendChild(inp);
          });
        }

        if (inputsWrap.childElementCount){
          meta.appendChild(inputsWrap);
        }

        el.appendChild(chk);
        el.appendChild(meta);
        calcBox.appendChild(el);
        COND_ELEMS[item.id] = el;
      });

      infoItems.forEach(item => {
        const el = document.createElement("div");
        el.className = "condItem";
        el.dataset.ref = item.ref || "";
        el.dataset.label = (item.text || "").toLowerCase();

        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.id = "i_" + item.id;

        COND_STATE[item.id] = { checked:false };

        const meta = document.createElement("div");
        meta.className = "condMeta";

        const title = document.createElement("div");
        title.className = "condTitle";
        title.innerHTML = `<span class="condRef">${item.ref || "—"}</span><span>${item.label || "Note"}</span>`;
        meta.appendChild(title);

        const desc = document.createElement("div");
        desc.className = "condDesc";
        desc.textContent = "Tick to show the clause text below (does not change the calculation).";
        meta.appendChild(desc);

        const detail = document.createElement("div");
        detail.className = "condDesc";
        detail.style.display = "none";
        detail.textContent = item.text || "";
        meta.appendChild(detail);

        chk.addEventListener("change", () => {
          COND_STATE[item.id].checked = chk.checked;
          detail.style.display = chk.checked ? "block" : "none";
        });

        el.appendChild(chk);
        el.appendChild(meta);
        infoBox.appendChild(el);
        COND_ELEMS[item.id] = el;
      });

      applyRoleEligibilityToConditions();
    }

    function applyRoleEligibilityToConditions(){
      // If a role isn’t eligible for an item (based on dataset boolean columns),
      // we grey it out. Eligibility is computed at runtime using the role’s columns.
      if (!DATA || !SELECTED_ROLE) return;

      const role = SELECTED_ROLE;
      const all = DATA.conditions_catalog || [];

      all.forEach(item => {
        const el = COND_ELEMS[item.id];
        if (!el) return;

        // eligibility rules:
        // - if role has a column matching item.ref (or rate_ref), it means this condition can apply
        // - otherwise we still allow it (for “Other allowances”), but grey it out to hint it might not apply
        const refKey = item.rate_ref || item.ref;
        const hasFlag = (role && refKey && Object.prototype.hasOwnProperty.call(role, refKey)) ? !!role[refKey] : null;

        // only apply "disabled" styling when the flag exists AND is false
        const shouldDisable = (hasFlag === false) && item.kind !== "info";
        el.style.opacity = shouldDisable ? "0.35" : "1";
        el.style.pointerEvents = shouldDisable ? "none" : "auto";
      });
    }

    function filterConditions(q){
      const s = (q || "").trim().toLowerCase();
      Object.values(COND_ELEMS).forEach(el => {
        const ref = (el.dataset.ref || "").toLowerCase();
        const label = (el.dataset.label || "");
        const show = !s || ref.includes(s) || label.includes(s);
        el.style.display = show ? "flex" : "none";
      });
    }

    // ==========================================================
    //  Calculator math (gross + extras)
    // ==========================================================
    function getSelectedDateKey(){
      const el = document.querySelector('input[name="effDate"]:checked');
      return el ? el.value : "salary_current";
    }

    function roleBaseAnnual(role, dateKey){
      const rt = (role.rate_type || "").toLowerCase();
      if (rt.includes("annual")){
        const v = role[dateKey];
        return (typeof v === "number" && isFinite(v)) ? v : null;
      }
      // unit rates: use override
      const o = Number(document.getElementById("annualisedOverride").value || 0);
      return o > 0 ? o : null;
    }

    function applyAwardMinimum(code, base){
      if (!AWARD_MIN) return base;
      const min = AWARD_MIN[code];
      if (typeof min !== "number" || !isFinite(min)) return base;
      return Math.max(base, min);
    }

    function allowanceValue(ref, dateKey){
      // Allowances are also stored in global_rates with ref keys, but we prioritise allowances list.
      // dateKey is one of: salary_current, salary_2025_08_01, etc -> convert.
      const map = {
        "salary_current": "current",
        "salary_2025_08_01": "2025_08_01",
        "salary_2026_07_01": "2026_07_01",
        "salary_2027_07_01": "2027_07_01"
      };
      const k = map[dateKey] || "current";
      // try global_rates
      const gr = DATA.global_rates?.[ref];
      if (gr && typeof gr[k] === "number") return gr[k];
      return null;
    }

    function computeExtrasAnnual(role, dateKey, baseAfterFTE){
      let extras = 0;

      // Night shift (17.1): percent of base salary (share-based)
      const night = DATA.conditions_catalog?.find(x => x.id === "night_shift");
      if (night && COND_STATE[night.id]?.checked){
        const share = Number(COND_STATE[night.id]?.nightShare || 0) / 100;
        const rate = allowanceValue("17.1", dateKey); // percent
        if (typeof rate === "number"){
          extras += baseAfterFTE * share * rate;
        }
      }

      // On-call (16.2 per night, 16.3 per day)
      const oc = DATA.conditions_catalog?.find(x => x.id === "on_call");
      if (oc && COND_STATE[oc.id]?.checked){
        const wkN = Number(COND_STATE[oc.id]?.onCallWeeknights || 0);
        const weD = Number(COND_STATE[oc.id]?.onCallWeekendDays || 0);
        const r162 = allowanceValue("16.2", dateKey);
        const r163 = allowanceValue("16.3", dateKey);
        if (typeof r162 === "number") extras += wkN * r162 * 26; // per fortnight count * 26 = annual
        if (typeof r163 === "number") extras += weD * r163 * 26;
      }

      // Fixed allowances from Schedule 1 etc
      (DATA.allowances || []).forEach(a => {
        const id = "allow_" + a.ref;
        const st = COND_STATE[id];
        if (!st || !st.checked) return;

        const v = allowanceValue(a.ref, dateKey);
        if (typeof v !== "number") return;

        if (a.unit === "per_fortnight"){
          extras += v * 26;
        }else{
          extras += v;
        }
      });

      // Manual extras
      const otherAnnual = Number(document.getElementById("otherAnnual").value || 0);
      const otherFortnight = Number(document.getElementById("otherFortnight").value || 0);
      extras += (otherAnnual > 0 ? otherAnnual : 0);
      extras += (otherFortnight > 0 ? otherFortnight * 26 : 0);

      return extras;
    }

    function scenario(role, dateKey, hasHELP, noPrivate){
      const fte = Math.max(0.1, Math.min(1, Number(document.getElementById("fte").value || 1)));
      let base = roleBaseAnnual(role, dateKey);
      if (base === null) return null;

      const applyAward = document.getElementById("applyAwardMin")?.checked;
      if (applyAward && dateKey === "salary_current"){
        base = applyAwardMinimum(role.code, base);
      }

      const baseAfterFTE = base * fte;
      const extras = computeExtrasAnnual(role, dateKey, baseAfterFTE);

      const gross = baseAfterFTE + extras;

      const np = netPay(gross, hasHELP, noPrivate);
      const annNet = np.net;
      const finNet = annNet / 26;

      return {
        dateKey,
        base: baseAfterFTE,
        extras,
        gross,
        annNet,
        finNet,
        breakdown: np.breakdown
      };
    }

    // ==========================================================
    //  UI wiring
    // ==========================================================
    function wireUI(){
      const classSearch = document.getElementById("classSearch");
      const classList = document.getElementById("classList");

      classSearch.addEventListener("input", () => {
        ACTIVE_CLASS_IDX = -1;
        const items = filterRoles(classSearch.value);
        renderClassList(items);
      });

      classSearch.addEventListener("focus", () => {
        ACTIVE_CLASS_IDX = -1;
        const items = filterRoles(classSearch.value);
        renderClassList(items);
      });

      classSearch.addEventListener("keydown", (e) => {
        const items = Array.from(classList.children);
        if (!items.length) return;

        if (e.key === "ArrowDown"){
          e.preventDefault();
          ACTIVE_CLASS_IDX = Math.min(items.length - 1, ACTIVE_CLASS_IDX + 1);
          items.forEach((n,i)=>n.classList.toggle("isActive", i===ACTIVE_CLASS_IDX));
          items[ACTIVE_CLASS_IDX].scrollIntoView({ block: "nearest" });
        }else if (e.key === "ArrowUp"){
          e.preventDefault();
          ACTIVE_CLASS_IDX = Math.max(0, ACTIVE_CLASS_IDX - 1);
          items.forEach((n,i)=>n.classList.toggle("isActive", i===ACTIVE_CLASS_IDX));
          items[ACTIVE_CLASS_IDX].scrollIntoView({ block: "nearest" });
        }else if (e.key === "Enter"){
          if (ACTIVE_CLASS_IDX >= 0 && items[ACTIVE_CLASS_IDX]){
            e.preventDefault();
            // select based on visible list
            const q = classSearch.value;
            const filtered = filterRoles(q);
            const pick = filtered[ACTIVE_CLASS_IDX]?.r;
            if (pick) selectRole(pick);
          }
        }else if (e.key === "Escape"){
          classList.style.display = "none";
        }
      });

      document.addEventListener("click", closeClassListIfClickedOutside);

      // date chips active state
      document.querySelectorAll('input[name="effDate"]').forEach(r => {
        r.addEventListener("change", () => {
          document.querySelectorAll("#dateChips .chip").forEach(ch => ch.classList.remove("isActive"));
          r.closest(".chip")?.classList.add("isActive");
        });
      });

      // conditions filter
      document.getElementById("condSearch").addEventListener("input", (e) => {
        filterConditions(e.target.value);
      });

      document.getElementById("btnCalc").addEventListener("click", calculate);
      document.getElementById("btnClear").addEventListener("click", clearAll);

      // close hamburger menus
      document.addEventListener('click', (event) => {
        document.querySelectorAll('details.menu[open]').forEach((menu) => {
          if (!menu.contains(event.target)) menu.removeAttribute('open');
        });
      });
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          document.querySelectorAll('details.menu[open]').forEach((menu) => {
            menu.removeAttribute('open');
          });
        }
      });
    }

    function calculate(){
      if (!SELECTED_ROLE){
        document.getElementById("classSelectedHelp").textContent = "Select a classification first.";
        return;
      }

      const hasHELP = document.getElementById("hasHELP").checked;
      const noPrivate = document.getElementById("noPrivateHealth").checked;

      const current = scenario(SELECTED_ROLE, "salary_current", hasHELP, noPrivate);
      const effKey = getSelectedDateKey();
      const selected = scenario(SELECTED_ROLE, effKey, hasHELP, noPrivate);

      if (!current || !selected){
        document.getElementById("classSelectedHelp").textContent =
          "Missing salary data for this classification/date. If it's a unit rate, enter Annualised gross.";
        return;
      }

      const rows = [
        { name: "Current", s: current },
        { name: "Selected (" + effKey.replace("salary_","").replaceAll("_","-") + ")", s: selected }
      ];

      // build KPIs
      const kpi = document.getElementById("kpiGrid");
      kpi.innerHTML = "";

      const deltaGross = selected.gross - current.gross;
      const deltaFin = selected.finNet - current.finNet;
      const pct = current.gross > 0 ? (deltaGross / current.gross) : null;

      const kpis = [
        { k:"Current gross", v: fmtMoney(current.gross,0), s:"Annual gross incl. selected extras" },
        { k:"New gross", v: fmtMoney(selected.gross,0), s:"Annual gross incl. selected extras" },
        { k:"Change", v: (deltaGross>=0?"+":"") + fmtMoney(deltaGross,0), s: pct!==null ? ( (pct>=0?"+":"") + (pct*100).toFixed(2) + "%") : "—" },
        { k:"Fortnight net change", v: (deltaFin>=0?"+":"") + fmtMoney(deltaFin,2), s:"Estimated (after tax/Medicare/MLS/HELP)" }
      ];

      kpis.forEach(x => {
        const div = document.createElement("div");
        div.className = "kpi";
        div.innerHTML = `<div class="k">${x.k}</div><div class="v">${x.v}</div><div class="s">${x.s}</div>`;
        kpi.appendChild(div);
      });

      // build table
      const tbody = document.getElementById("resultsBody");
      tbody.innerHTML = "";
      rows.forEach(r => {
        const d = r.s;
        const change = d.gross - current.gross;
        const cls = change >= 0 ? "pos" : "neg";
        tbody.innerHTML += `
          <tr>
            <td class="rowLabel">${r.name}</td>
            <td class="num">${fmtMoney(d.base,0)}</td>
            <td class="num">${fmtMoney(d.extras,0)}</td>
            <td class="num"><span class="numStrong">${fmtMoney(d.gross,0)}</span></td>
            <td class="num"><span class="${cls}">${(change>=0?"+":"") + fmtMoney(change,0)}</span></td>
            <td class="num">${fmtMoney(d.annNet,2)}</td>
            <td class="num"><span class="numStrong">${fmtMoney(d.finNet,2)}</span></td>
          </tr>
        `;
      });

      // notes
      const noteParts = [];
      noteParts.push(`Classification: ${SELECTED_ROLE.code || "—"} (${SELECTED_ROLE.stream || "—"})`);
      noteParts.push(`FTE: ${Number(document.getElementById("fte").value || 1).toFixed(2)}`);
      if (document.getElementById("applyAwardMin")?.checked && AWARD_MIN){
        const m = AWARD_MIN[SELECTED_ROLE.code];
        if (typeof m === "number") noteParts.push(`Award minimum check: ${fmtMoney(m,0)} (current only)`);
      }
      const shown = Object.entries(COND_STATE).filter(([id,st]) => st.checked).map(([id]) => id);
      if (shown.length){
        noteParts.push(`Selected conditions: ${shown.length} item(s)`);
      }else{
        noteParts.push("Selected conditions: none");
      }
      document.getElementById("notesText").textContent = noteParts.join(" · ");

      document.getElementById("outputs").style.display = "block";
    }

    function clearAll(){
      document.getElementById("classSearch").value = "";
      document.getElementById("classSelectedHelp").textContent = "No classification selected yet.";
      document.getElementById("fte").value = "1.0";
      document.getElementById("hasHELP").checked = false;
      document.getElementById("noPrivateHealth").checked = false;
      if (document.getElementById("applyAwardMin")) document.getElementById("applyAwardMin").checked = false;
      document.getElementById("otherAnnual").value = "0";
      document.getElementById("otherFortnight").value = "0";
      document.getElementById("annualisedOverride").value = "";
      document.getElementById("unitOverrideWrap").style.display = "none";
      document.getElementById("outputs").style.display = "none";
      document.getElementById("resultsBody").innerHTML = "";
      document.getElementById("kpiGrid").innerHTML = "";

      // reset conditions
      Object.keys(COND_STATE).forEach(id => {
        COND_STATE[id].checked = false;
        const chk = document.getElementById((id.startsWith("info_") ? "i_" : "c_") + id);
        if (chk) chk.checked = false;
      });
      // clear info reveals
      document.querySelectorAll("#condInfo .condDesc").forEach(d => {
        if (d.textContent && d.textContent.startsWith("7.") || d.textContent.startsWith("8.") || d.textContent.startsWith("12.") || d.textContent.startsWith("15.")){
          // noop
        }
      });
      // reset filters
      document.getElementById("condSearch").value = "";
      filterConditions("");
      SELECTED_ROLE = null;
    }

    // init on load
    init();
  </script>

  <!-- GoatCounter -->
  <script data-goatcounter="https://sa-ps-wages.goatcounter.com/count"
          async src="https://gc.zgo.at/count.js"></script>

  <script>
    (function(){
      const el = document.getElementById('gc-hud');
      if (!el) return;

      const path = location.pathname || '/';
      const url = 'https://sa-ps-wages.goatcounter.com/counter/' + encodeURIComponent(path) + '.json?no_branding=1';

      fetch(url, { cache: 'no-store' })
        .then(r => r.ok ? r.json() : Promise.reject(r.status))
        .then(data => { el.textContent = `Views: ${data.count}`; })
        .catch(() => { el.textContent = 'Views: —'; });
    })();
  </script>
</body>
</html>
